angular.module("ng.cork.input-tags.templates",[]).run(["$templateCache",function(a){a.put("lib/ng.cork.input-tags/control.tpl.html",'<ng-form name=form class=cork-input-tags-control ng-class="{\'cork-is-disabled\': disabled}"><div class=cork-it-list><div class=cork-it-tag ng-repeat="tag in model" ng-class="{\'cork-is-selected\': selIx === $index, \'cork-will-delete\': willDelete}" title="Tag \'{{tag[opts.attr.label]}}\', press backspace to highlight this tag for removal, press left to select previous tag, press right to select next tag, press escape to return to the add tag input." ng-focus=onCursorFocus($index) ng-keydown="onCursorKeyDown($event, $index)" ng-keyup="onCursorKeyUp($event, $index)" ng-blur=onCursorBlur($index) cork-ui-focus-on=focus-cursor-{{$index}}><div class=cork-it-label><div class=cork-it-content ng-include=opts.tpl.label></div></div><button class=cork-it-remove-btn title="Tag \'{{tag[opts.attr.label]}}\', press backspace to remove tag, press left to select previous tag, press right to select next tag, press escape to return to the add tag input." ng-click=removeTag(tag) ng-focus=onRemoveBtnFocus($index) ng-keydown="onRemoveBtnKeyDown($event, $index)" ng-blur=onRemoveBtnBlur($index) cork-ui-enter-click cork-ui-stop-propagation cork-events="[\'keydown\']" cork-ui-focus-on=focus-remove-btn-{{$index}}><i class="cork-icon fa fa-times"></i> <span class=cork-icon-text>remove</span></button></div></div><input class=form-control ng-model=newLabel placeholder={{opts.placeholder}} ng-focus=onInputFocus() ng-keyup=onInputKeyUp($event) ng-keydown=onInputKeyDown($event) ng-blur="onInputBlur()"></ng-form>'),a.put("lib/ng.cork.input-tags/input.tpl.html","<div class=cork-input-tags-input ng-class=\"{'cork-is-disabled': disabled}\"><div cork-input-tags-control cork-uuid={{uuid}} cork-options=opts ng-model=model></div><div class=cork-input-tags-results-container><div cork-input-tags-results cork-uuid={{uuid}} cork-options=opts></div></div></div>"),a.put("lib/ng.cork.input-tags/label.tpl.html","<div>{{tag[opts.attr.label]}}</div>"),a.put("lib/ng.cork.input-tags/result.tpl.html","<div>{{tag[opts.attr.label]}}</div>"),a.put("lib/ng.cork.input-tags/results.tpl.html",'<div class=cork-input-tags-results><div class=cork-it-tag ng-repeat="tag in results" ng-class="{\'cork-is-selected\': selIx === $index}" ng-click=tagClick(tag)><div class=cork-it-add-icon><i class="cork-icon fa fa-plus"></i> <span class=cork-icon-text>add</span></div><div class=cork-it-label><div class=cork-it-content ng-include=opts.tpl.result></div></div></div></div>')}]),function(a){"use strict";function b(a){return!!a&&i(a.then)}var c=a.module("ng.cork.input-tags",["ng.cx.generate","ng.cork.throttling","ng.cork.pubsub","ng.cork.ui.keys","ng.cork.ui.focus-on","ng.cork.ui.enter-click","ng.cork.ui.stop-propagation","ng.cork.input-tags.templates"]),d=a.noop,e=a.element,f=a.copy,g=a.isObject,h=a.isArray,i=a.isFunction;c.provider("corkInputTagsConfig",["corkDeepExtend",function(a){var b=this,c={minLength:3,addFn:d,searchFn:d,attr:{id:"id",label:"label"},tpl:{label:"lib/ng.cork.input-tags/label.tpl.html",result:"lib/ng.cork.input-tags/result.tpl.html"},debounceMs:500};b.configure=function(b){a(c,b)},b.$get=[function(){var a=function(){var a=this;a.setSearchFn=function(a){c.searchFn=a},Object.defineProperty(a,"config",{get:function(){return f(c)}})};return new a}]}]),c.directive("corkInputTags",["corkDeepExtend","corkInputTagsConfig","cxGenerate",function(a,b,c){return{templateUrl:"lib/ng.cork.input-tags/input.tpl.html",restrict:"A",require:"ngModel",scope:{options:"=corkOptions",model:"=ngModel"},link:function(d,e,g){d.uuid=c.uuid();var h=b.config;d.opts=a(f(h),d.options||{})}}}]),c.directive("corkInputTagsControl",["$timeout","corkDeepExtend","corkInputTagsConfig","corkPubsub","corkUiKeys","corkThrottling",function(a,c,d,j,k,l){var m=[k.key.Up,k.key.Down,k.key.Enter];return{templateUrl:"lib/ng.cork.input-tags/control.tpl.html",restrict:"A",require:"ngModel",scope:{model:"=ngModel",uuid:"@corkUuid",disabled:"=corkDisabled",options:"=corkOptions"},link:function(n,o,p,q){function r(b){var c=n.model.length,d=c-1;0>b&&(b=c?0:-1),b>d&&(b=-1),n.selIx=b,-1===b?H[0].focus():a(function(){n.$broadcast("focus-cursor-"+b)})}function s(a){var b=n.model.indexOf(a);n.model.splice(b,1)}function t(){n.enabled=!n.disabled&&!n.unbound}var u={MIN_TAGS:"cork-input-tags-min",MAX_TAGS:"cork-input-tags-max"},v=[],w="corkInputTags."+n.uuid,x=d.config,y=n.opts=c(f(x),n.options||{}),z=y.minLength,A=y.addFn,B=(y.attr.id,y.attr.label),C=y.tpl.label,D=0,E=0,F=0,G=y.debounceMs,H=e(o.find("input")),I=null;n.unbound=!h(n.model),n.enabled=!1,n.opts={placeholder:null,attr:{label:B},tpl:{label:C}},n.selIx=-1,n.willDelete=!1;var J=l.debounceBoth(function(a){j.publish(w+".search",a)},G,!0),K=function(a,b){I=b},L=function(a,b){n.addTag(b)};v.push(j.subscribe(w+".updateSelectedResultsTag",K)),v.push(j.subscribe(w+".resultClicked",L)),n.addTag=function(a){E&&!F&&n.model.length>=E||(n.model.push(a),n.newLabel="",j.publish(w+".clearResults"))},n.addNewTag=function(a){if(!(E&&!F&&n.model.length>=E||z&&!a||a.length<z)){var c=A(a);b(c)?c.then(function(a){g(a)&&n.addTag(a)}):g(c)&&n.addTag(c)}},n.unselectTag=function(){n.selIx=-1,n.willDelete=!1,H[0].focus()},n.removeTag=function(a){s(a),n.unselectTag()},n.onInputFocus=function(a){n.unselectTag()},n.onInputKeyDown=function(a){var b=k.getCode(a);(b===k.key.Down||b===k.key.Up)&&a.preventDefault(),0===H[0].selectionEnd&&(b===k.key.Left&&r(n.model.length-1),b===k.key.Backspace&&(r(n.model.length-1),n.$broadcast("focus-remove-btn-"+n.selIx)))},n.onInputKeyUp=function(a){var b=k.getCode(a);-1!==m.indexOf(b)&&a.preventDefault(),b===k.key.Down?j.publish(w+".nextResult"):b===k.key.Up?j.publish(w+".previousResult"):b===k.key.Enter&&(I?n.addTag(I):i(A)&&n.addNewTag(n.newLabel))},n.onInputBlur=function(){},n.onCursorFocus=function(a){n.selIx=a},n.onCursorKeyDown=function(a,b){a.preventDefault();var c=k.getCode(a);c===k.key.Esc?n.unselectTag():c===k.key.Backspace?n.$broadcast("focus-remove-btn-"+b):c===k.key.Left&&r(n.selIx-1),c===k.key.Right&&r(n.selIx+1)},n.onCursorKeyUp=function(a,b){a.preventDefault();k.getCode(a)},n.onCursorBlur=function(a){},n.onRemoveBtnFocus=function(a){n.willDelete=!0},n.onRemoveBtnKeyDown=function(a,b){a.preventDefault();var c=k.getCode(a);c===k.key.Esc?n.unselectTag():c===k.key.Backspace?(s(n.model[n.selIx]),r(n.selIx-1),n.willDelete=!1):c===k.key.Left?(r(n.selIx-1),n.willDelete=!1):c===k.key.Right&&(r(n.selIx+1),n.willDelete=!1)},n.onRemoveBtnBlur=function(a){n.willDelete=!1},n.$watch("disabled",function(){t()}),n.$watch("model",function(a){h(a),j.publish(w+".updateExcludeTagIds",n.model),D&&n.form.$setValidity(u.MIN_TAGS,n.model.length>=D),E&&n.form.$setValidity(u.MAX_TAGS,n.model.length<=E),t()},!0),n.$watch("newLabel",function(a){a&&a.length>=z?J(a):(!a||a.length<z)&&j.publish(w+".clearResults")}),n.$on("$destroy",function(){j.unsubscribeArr(v)})}}}]).directive("corkInputTagsResults",["corkDeepExtend","corkInputTagsConfig","corkPubsub",function(a,c,d){return{templateUrl:"lib/ng.cork.input-tags/results.tpl.html",restrict:"A",scope:{uuid:"@corkUuid",options:"=corkOptions"},link:function(e,g,j){function k(a){e.results.length=0;var b;if(h(a))for(var c=0;c<a.length;c++)b=a[c],x&&-1!==x.indexOf(b[r])||e.results.push(b)}function l(a){var b;if(0>a&&w)for(b=0;b<e.results.length;b++)if(w===e.results[b][r])return e.selIx=b,void(v||(v=e.results[b],d.publish(n+".updateSelectedResultsTag",v)));a+1>e.results.length&&(a=e.results.length-1),0>a&&(a=e.results.length?0:-1),e.selIx=a,a>=0?(w=e.results[a][r],v&&w===v.id||(v=e.results[a],d.publish(n+".updateSelectedResultsTag",v))):v&&(v=null,d.publish(n+".updateSelectedResultsTag",v))}var m=[],n="corkInputTags."+e.uuid,o=c.config,p=e.opts=a(f(o),e.options||{}),q=p.searchFn,r=p.attr.id,s=p.attr.label,t=p.tpl.result,u=[],v=null,w=null,x=null;e.selIx=-1,e.results=[],e.opts={attr:{label:s},tpl:{result:t}};var y=function(a,b){if(b&&b.length){x=[];for(var c=0;c<b.length;c++)x.push(b[c][r])}else x=[];k(u),l(-1)},z=function(a){a=a||[],u=f(a),k(a),l(-1)},A=function(a,c){var d=i(q)?q(c):null;b(d)?d.then(function(a){z(a)}):z(d)},B=function(){u=[],e.results=[],l(-1)},C=function(){l(e.selIx+1)},D=function(a,b){l(e.selIx-1)};m.push(d.subscribe(n+".updateExcludeTagIds",y)),m.push(d.subscribe(n+".search",A)),m.push(d.subscribe(n+".clearResults",B)),m.push(d.subscribe(n+".nextResult",C)),m.push(d.subscribe(n+".previousResult",D)),e.tagClick=function(a){d.publish(n+".resultClicked",e.results[e.selIx])},e.$on("$destroy",function(){d.unsubscribeArr(m)})}}}])}(angular);