angular.module("ng.cork.input-tags.templates",[]).run(["$templateCache",function(a){a.put("lib/ng.cork.input-tags/inputTags.tpl.html","<ng-form name=form class=\"cork-input-tags cork-input-tags-control\" ng-class=\"{'cork-is-disabled': disabled, 'cork-it-results-block': opts.display.results === 'block', 'cork-it-results-inline': opts.display.results === 'inline', 'cork-it-tags-block': opts.display.tags === 'block', 'cork-it-tags-inline': opts.display.tags === 'inline'}\"><div ng-if=\"opts.display.tags !== 'hide'\" cork-input-tags-tags ng-model=model cork-uuid={{UUID}} cork-options=options cork-disabled=disabled></div><div class=cork-it-input-container><input class=form-control ng-model=newLabel placeholder={{opts.placeholder}} ng-focus=onInputFocus() ng-keyup=onInputKeyUp($event) ng-keydown=\"onInputKeyDown($event)\"><div ng-if=\"opts.display.results !== 'hide'\" class=cork-it-results-container><div cork-input-tags-results cork-uuid={{UUID}} cork-options=opts></div></div></div></ng-form>"),a.put("lib/ng.cork.input-tags/inputTagsResults.tpl.html",'<div class="cork-input-tags cork-input-tags-results"><div class=cork-it-tag ng-repeat="tag in results" ng-class="{\'cork-is-selected\': selIx === $index}" ng-click=tagClick(tag)><div class=cork-it-add-icon><i class="cork-icon fa fa-plus"></i> <span class=cork-icon-text>add</span></div><div class=cork-it-label><div class=cork-it-content ng-include=opts.tpl.result></div></div></div></div>'),a.put("lib/ng.cork.input-tags/inputTagsTags.tpl.html",'<div class="cork-input-tags cork-input-tags-tags"><div class=cork-it-tag ng-repeat="tag in model" ng-class="{\'cork-is-selected\': selIx === $index, \'cork-will-delete\': willDelete}" title="Tag \'{{tag[opts.attr.label]}}\', press backspace to highlight this tag for removal, press left to select previous tag, press right to select next tag, press escape to return to the add tag input." ng-focus=onTagFocus($index) ng-keydown="onTagKeyDown($event, $index)" cork-ui-focus-on=corkInputTags.focus-tag-{{$index}}><div class=cork-it-label><div class=cork-it-content ng-include=opts.tpl.label></div></div><button class=cork-it-remove-btn title="Tag \'{{tag[opts.attr.label]}}\', press backspace to remove tag, press left to select previous tag, press right to select next tag, press escape to return to the add tag input." ng-click=removeTag(tag) ng-focus=onRemoveBtnFocus($index) ng-keydown="onRemoveBtnKeyDown($event, $index)" ng-blur=onRemoveBtnBlur($index) cork-ui-enter-click cork-ui-stop-propagation cork-events="[\'keydown\']" cork-ui-focus-on=corkInputTags.focus-remove-btn-{{$index}}><i class="cork-icon fa fa-times"></i> <span class=cork-icon-text>remove</span></button></div></div>'),a.put("lib/ng.cork.input-tags/label.tpl.html","<div>{{tag[opts.attr.label]}}</div>"),a.put("lib/ng.cork.input-tags/result.tpl.html","<div>{{tag[opts.attr.label]}}</div>")}]),function(a){"use strict";function b(a){return!!a&&i(a.then)}var c=a.module("ng.cork.input-tags",["ng.cx.generate","ng.cork.throttling","ng.cork.pubsub","ng.cork.ui.keys","ng.cork.ui.focus-on","ng.cork.ui.enter-click","ng.cork.ui.stop-propagation","ng.cork.input-tags.templates"]),d=a.noop,e=a.element,f=a.copy,g=a.isObject,h=a.isArray,i=a.isFunction;c.provider("corkInputTagsConfig",["corkDeepExtend",function(a){var b=this,c={minLength:2,addFn:d,searchFn:d,attr:{id:"id",label:"label"},display:{tags:"inline",results:"inline"},tpl:{label:"lib/ng.cork.input-tags/label.tpl.html",result:"lib/ng.cork.input-tags/result.tpl.html"},debounceMs:500};b.configure=function(b){a(c,b)},b.$get=[function(){var a=function(){var a=this;a.setSearchFn=function(a){c.searchFn=a},Object.defineProperty(a,"config",{get:function(){return f(c)}})};return new a}]}]),c.directive("corkInputTags",["cxGenerate","corkDeepExtend","corkInputTagsConfig","corkPubsub","corkUiKeys","corkThrottling",function(a,c,d,j,k,l){var m=[k.key.Up,k.key.Down,k.key.Enter];return{templateUrl:"lib/ng.cork.input-tags/inputTags.tpl.html",restrict:"A",require:"ngModel",scope:{model:"=ngModel",uuid:"@corkUuid",options:"=corkOptions",disabled:"=corkDisabled"},link:function(n,o,p,q){function r(){G[0].focus()}function s(a){var b=n.model.indexOf(a);n.model.splice(b,1)}function t(){n.enabled=!n.disabled&&!n.unbound}function u(){H=null,j.publish(F+".results.clearResults")}var v={MIN_TAGS:"cork-input-tags-min",MAX_TAGS:"cork-input-tags-max"},w=[],x=d.config,y=n.opts=c(f(x),n.options||{});n.UUID=n.uuid||a.uuid();var z=y.minLength,A=y.addFn,B=(y.attr.id,y.attr.label,y.tpl.label,0),C=0,D=0,E=y.debounceMs,F="corkInputTags."+n.UUID,G=e(o.find("input")),H=null;n.unbound=!h(n.model),n.enabled=!1,n.selIx=-1,n.willDelete=!1;var I=l.debounceBoth(function(a){j.publish(F+".results.search",a)},E,!0),J=function(){"hide"!==y.display.tags&&r()},K=function(a,b){s(b)},L=function(a,b){H=b},M=function(a,b){n.addTag(b),G[0].focus()};w.push(j.subscribe(F+".tags.onBlur",J)),w.push(j.subscribe(F+".tags.onRemoveTag",K)),w.push(j.subscribe(F+".results.onSelectResult",L)),w.push(j.subscribe(F+".results.onResultClicked",M)),n.addTag=function(a){C&&!D&&n.model.length>=C||(n.model.push(a),n.newLabel="",u())},n.addNewTag=function(a){if(!(C&&!D&&n.model.length>=C||z&&!a||a.length<z)){var c=A(a);b(c)?c.then(function(a){g(a)&&n.addTag(a)}):g(c)&&n.addTag(c)}},n.removeTag=function(a){s(a),j.publish(F+".tags.unselectTags"),G[0].focus()},n.onInputFocus=function(a){j.publish(F+".tags.unselectTags")},n.onInputKeyDown=function(a){var b=k.getCode(a);(b===k.key.Down||b===k.key.Up)&&a.preventDefault(),0===G[0].selectionEnd&&"hide"!==y.display.tags&&(b===k.key.Left&&j.publish(F+".tags.selectLastTag"),b===k.key.Backspace&&(j.publish(F+".tags.selectLastTag"),j.publish(F+".tags.focusRemoveButton")))},n.onInputKeyUp=function(a){var b=k.getCode(a);-1!==m.indexOf(b)&&a.preventDefault(),b===k.key.Down?j.publish(F+".results.nextResult"):b===k.key.Up?j.publish(F+".results.previousResult"):b===k.key.Enter&&(H?n.addTag(H):i(A)&&n.addNewTag(n.newLabel))},n.$watch("newLabel",function(a){a&&a.length>=z?I(a):(!a||a.length<z)&&u()}),n.$watch("model",function(a){j.publish(F+".results.updateExcludeTagIds",n.model),B&&n.form.$setValidity(v.MIN_TAGS,n.model.length>=B),C&&n.form.$setValidity(v.MAX_TAGS,n.model.length<=C),n.unbound=!h(a),t()},!0),n.$watch("disabled",function(){t()}),n.$on("$destroy",function(){j.unsubscribeArr(w)})}}}]),c.directive("corkInputTagsTags",["$timeout","corkDeepExtend","corkInputTagsConfig","corkPubsub","corkUiKeys",function(a,b,c,d,e){return{templateUrl:"lib/ng.cork.input-tags/inputTagsTags.tpl.html",restrict:"A",require:"ngModel",scope:{model:"=ngModel",uuid:"@corkUuid",options:"=corkOptions",disabled:"=corkDisabled"},link:function(g,i,j,k){function l(b){var c=g.model&&g.model.length||0,e=c-1;0>b&&(b=c?0:-1),b>e&&(b=-1),g.selIx=b,-1===b?d.publish(r+".tags.onBlur"):a(function(){g.$broadcast("corkInputTags.focus-tag-"+b)})}function m(){g.enabled=!g.disabled&&!g.unbound}function n(){g.selIx=-1,g.willDelete=!1}function o(){g.model&&g.model.length&&(g.selIx=g.model.length-1,g.$broadcast("corkInputTags.focus-tag-"+g.selIx))}function p(){g.$broadcast("corkInputTags.focus-remove-btn-"+g.selIx)}{var q=[],r="corkInputTags."+g.uuid,s=c.config,t=g.opts=b(f(s),g.options||{});t.searchFn,t.attr.id,t.attr.label,t.tpl.result}g.unbound=!1,g.enabled=!1,g.selIx=-1,g.willDelete=!1;var u=function(a){d.publish(r+".tags.onRemoveTag",a)};q.push(d.subscribe(r+".tags.unselectTags",n)),q.push(d.subscribe(r+".tags.selectLastTag",o)),q.push(d.subscribe(r+".tags.focusRemoveButton",p)),g.onTagFocus=function(a){g.selIx=a},g.onTagKeyDown=function(a,b){a.preventDefault();var c=e.getCode(a);c===e.key.Esc?(n(),d.publish(r+".tags.onBlur")):c===e.key.Backspace?g.$broadcast("corkInputTags.focus-remove-btn-"+b):c===e.key.Left&&l(g.selIx-1),c===e.key.Right&&l(g.selIx+1)},g.onRemoveBtnFocus=function(a){g.willDelete=!0},g.removeTag=function(a){var b=g.model.indexOf(a);u(a),l(b),g.willDelete=!1},g.onRemoveBtnKeyDown=function(a,b){a.preventDefault();var c=e.getCode(a);c===e.key.Esc?(n(),d.publish(r+".tags.onBlur")):c===e.key.Backspace?(u(g.model[g.selIx]),l(g.selIx-1),g.willDelete=!1):c===e.key.Left?(l(g.selIx-1),g.willDelete=!1):c===e.key.Right&&(l(g.selIx+1),g.willDelete=!1)},g.onRemoveBtnBlur=function(a){g.willDelete=!1},g.$watch("model",function(a){g.unbound=!h(a),m()}),g.$watch("disabled",function(){m()}),g.$on("$destroy",function(){d.unsubscribeArr(q)})}}}]),c.directive("corkInputTagsResults",["corkDeepExtend","corkInputTagsConfig","corkPubsub",function(a,c,d){return{templateUrl:"lib/ng.cork.input-tags/inputTagsResults.tpl.html",restrict:"A",scope:{uuid:"@corkUuid",options:"=corkOptions"},link:function(e,g,j){function k(a){e.results.length=0;var b;if(h(a))for(var c=0;c<a.length;c++)b=a[c],u&&-1!==u.indexOf(b[r])||e.results.push(b)}function l(a){a+1>e.results.length&&(a=e.results.length-1),0>a&&(a=e.results.length?0:-1),e.selIx=a,a>=0?t||(t=e.results[a],d.publish(n+".results.onSelectResult",t)):t&&(t=null,d.publish(n+".results.onSelectResult",t))}var m=[],n="corkInputTags."+e.uuid,o=c.config,p=e.opts=a(f(o),e.options||{}),q=p.searchFn,r=p.attr.id,s=(p.attr.label,p.tpl.result,[]),t=null,u=null;e.selIx=-1,e.results=[];var v=function(a,b){if(h(b)&&b.length){u=[];for(var c=0;c<b.length;c++)u.push(b[c][r])}else u=[];k(s),l(-1)},w=function(a){a=a||[],s=f(a),k(a),l(-1)},x=function(a,c){var d=i(q)?q(c):null;b(d)?d.then(function(a){w(a)}):w(d)},y=function(){s=[],e.results=[],l(-1)},z=function(){l(e.selIx+1)},A=function(a,b){l(e.selIx-1)};m.push(d.subscribe(n+".results.search",x)),m.push(d.subscribe(n+".results.updateExcludeTagIds",v)),m.push(d.subscribe(n+".results.clearResults",y)),m.push(d.subscribe(n+".results.nextResult",z)),m.push(d.subscribe(n+".results.previousResult",A)),e.tagClick=function(a){d.publish(n+".results.onResultClicked",e.results[e.selIx])},e.$on("$destroy",function(){d.unsubscribeArr(m)})}}}])}(angular);